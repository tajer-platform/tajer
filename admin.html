<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุงูููุญุฉ ุงูุฑุฆูุณูุฉ | ุฅุฏุงุฑูุฉ ุชูุงุฌูุฑ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="control.css">

</head>
<body>
<!--ุฅูุดุงุก ุฒุฑ ููุชุญ ูุงุบูุงู ุงููุงุฆูุฉ ุฌุงูุจูุฉ-->
<button class="menu-toggle" onclick="toggleSidebar()" style="display:none;"><i class="fas fa-bars"></i></button> 

    <!--ุงููุงุฆูุฉ ุงูุฌุงููุฉ -->
<div class="sidebar" id="sidebar">
    <!--ุนููุงู ูู ุฑุงุณ ุงููุงุฆูุฉ ุงูุฌุงููุฉ-->
    <div class="sidebar-header"><i class="fas fa-layer-group"></i> ุชูุงุฌุฑ <span>Admin</span></div>
    
    <!--ุงุฒุฑุงุฑ ุงูุชููู ุจูู ุงูุตูุญุงุช -->
    <div class="nav">
    
        <button class="active" onclick="openTab('dashboard',this)"><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</button>
        <button onclick="openTab('users',this)"><i class="fas fa-users"></i> ุงููุณุชุซูุฑูู</button>
        <button onclick="window.location.href='messages.html'"><i class="fas fa-comments"></i> ูุฑูุฒ ุงูุฑุณุงุฆู</button>
        <button onclick="openTab('market',this)"><i class="fas fa-store"></i> ุฅุฏุงุฑุฉ ุงูุณูู</button>
        <button onclick="openTab('withdrawals',this)"><i class="fas fa-money-bill-wave"></i> ุทูุจุงุช ุงูุณุญุจ</button>
        <button onclick="openTab('profits',this)"><i class="fas fa-hand-holding-usd"></i> ุชูุฒูุน ุงูุฃุฑุจุงุญ</button>
        <button onclick="openTab('logs',this)"><i class="fas fa-history"></i> ุงูุณุฌู</button>
        <button onclick="logout()" style="margin-top: 20px; color: red; background: none; border: 1px solid red; padding: 5px 10px; cursor: pointer;">
            <i class="fas fa-sign-out-alt"></i> ุชุณุฌูู ุงูุฎุฑูุฌ
</button>
    </div>
</div>
<!--ุงูุญุงููุฉ ุงูุงุณุงุณูุฉ ูู ูู ุงูุตูุญุงุช ุฏุงุฎู ูุฐุง ุงูููู -->
<div class="main">
    <!--ูุฎุตุต ูุธููุฑ "ุฅุดุนุงุฑุงุช ุตุบูุฑุฉ" (ูุซู: ุชู ุงูุญูุธ ุจูุฌุงุญ) ูู ุฒุงููุฉ ุงูุดุงุดุฉ.-->
    <div class="toast-container" id="toastContainer"></div>
    <!--ูุณู ุงูุฅุญุตุงุฆูุงุช ุจู ุตูุญุฉ ุงูุงุณุงุณูุฉ (Dashboard)-->
    <div id="dashboard" class="tab active">
        <!--ุงูุญุงููุฉ ุงููุจุฑู ุงูุชู ุชุฑุชุจ ุงููุฑุจุนุงุช ุจุฌุงูุจ ุจุนุถูุง ุจุดูู ููุธู (ุดุจูุฉ). -->
        <div class="grid">
            <!--ุงููุฑุจุน ููุณู :ุชุตููู ุงูุจุทุงูุฉ (ุฎูููุฉ ุจูุถุงุกุ ุธูุ ุฒูุงูุง ุฏุงุฆุฑูุฉ)-->
            <div class="stat-card border-l">
                <!--ูู ุงูุฃููููุฉ ุงูุชู ุชุธูุฑ ุฏุงุฎู ุงููุฑุจุน (ุฃููููุฉ ุชูุซู ูุฌููุนุฉ ุฃุดุฎุงุต).-->
                <i class="fas fa-users icon-bg"></i>
                <h3>ุฅุฌูุงูู ุงููุณุชุซูุฑูู</h3>
                <!--ุฃูู ุฌุฒุกุ ุงูุฑูู ุงูุฐู ุณูุธูุฑ ูููุณุชุฎุฏู (ุญุงููุงู 0).-->
                <span class="val" id="d-users">0</span>
            </div>
            
            <div class="stat-card border-s">
                <i class="fas fa-wallet icon-bg"></i>
                <h3>ุฑุฃุณ ุงููุงู (ู.ุณ)</h3>
                <span class="val" id="d-capital">0</span>
            </div>
            <div class="stat-card border-i">
                <i class="fas fa-boxes icon-bg"></i>
                <h3>ุฅุฌูุงูู ุงูุฃุณูู ุงููุจุงุนุฉ</h3>
                <span class="val" id="d-total-shares">0</span>
            </div>
            <div class="stat-card special" onclick="openModal('sharePriceModal')" style="cursor: pointer;">
                <i class="fas fa-chart-pie icon-bg"></i>
                <h3>ุณุนุฑ ุงูุณูู ุงูุญุงูู</h3> <span class="val" id="d-share-value">0</span>
                <span style="font-size: 0.8rem; opacity: 0.8;">ู.ุณ / ุงุถุบุท ููุชุนุฏูู</span>
            </div>

            <div class="modal-overlay" id="sharePriceModal">
                <div class="modal-box">
                    <div class="modal-header">
                        <span>ุชุญุฏูุซ ูููุฉ ุงูุณูู</span>
                        <button class="modal-close" onclick="closeModal('sharePriceModal')">&times;</button>
                    </div>
                    <div style="padding: 10px 0;">
                        <label style="display: block; margin-bottom: 10px; font-size: 0.9rem;">ุฃุฏุฎู ุงููููุฉ ุงูุฌุฏูุฏุฉ ููุณูู ุงููุงุญุฏ:</label>
                        <input type="number" id="manualSharePriceInput" placeholder="ูุซูุงู: 5000" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd;">
                    </div>
                    <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="saveSharePrice()">ุญูุธ ุงููููุฉ ุงูุฌุฏูุฏุฉ</button>
                </div>
            </div>
        </div>
        
        <div class="grid">
            <!--ูุฎุจุฑ ุงููุชุตูุญ ุฃู ูุฐุง ุงููุฑุจุน ูุฌุจ ุฃู ููุชุฏ ููุฃุฎุฐ ูุณุงุญุฉ ุนููุฏูู ุจุฏูุงู ูู ุนููุฏ ูุงุญุฏุ ููุธูุฑ ุจุดูู ุฃุนุฑุถ ูู ูุฑุจุนุงุช ุงูุฅุญุตุงุฆูุงุช ุงูุชู ูููู-->
             <div class="section" style="grid-column: span 2;">
                 <!--ุงุณู ุงูุฏุงูุฉ ููุชุนุฏูู ุนูููุง-->
                <div class="section-header">
                    <h2>๐ฅ ุขุฎุฑ ุงูุนูููุงุช ุงููุณุฌูุฉ</h2>
                    <!--ุฒุฑ ุจุญุฌู ุตุบูุฑ (Small) ุนูุฏ ุงูุถุบุท ุนูููุ ูููู "ุจุชุญูููู" ุชููุงุฆูุงู ุฅูู ุชุจููุจ ุงูุณุฌูุงุช (Logs) ูุชุฑู ูู ุงูุชูุงุตูู-->
                    <button class="btn btn-sm btn-primary" onclick="openTab('logs', document.querySelectorAll('.nav button')[5])">ุนุฑุถ ุงููู</button>
                </div>
                 <!--ุตูุฏูู ูุงุฑุบ" ูุคูุชุงู.

        ูููุฉ "ุฌุงุฑู ุงูุชุญููู..." ุชุธูุฑ ูููุณุชุฎุฏู ููุท ุญุชู ูููู ููุฏ ุงูู    JavaScript ุจุฌูุจ ุงูุจูุงูุงุช ุงูุญููููุฉ (ูุซู: "ูุงู ุฃุญูุฏ ุจุณุญุจ ูุจูุบ...") ููุถุนูุง ููุงู ูุฐู ุงููููุฉ-->
                <div id="miniLogBox">ุฌุงุฑู ุงูุชุญููู...</div>
             </div>
        </div>
    </div>
    <!--ูุฐุง ุงูููุฏ ูู ุงููุณุคูู ุนู ุนุฑุถ ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุซูุฑููุ ููู ูุชููู ูู ุฌุฒุฃูู ุฑุฆูุณููู: ุฑุฃุณ ุงูุตูุญุฉ (ุงูุนููุงู ูุงูุฒุฑ) ูุงูุฌุฏูู ุงูุฐู ุณูุนุฑุถ ุงูุฃุณูุงุก.-->
    <div id="users" class="tab">
        <div class="section">
            <!--ุนููุงู ุงูุตูุญุฉ ูุน ุฅูููุฌู ุชูุถูุญู.-->
            <div class="section-header">
                <h2>๐ฅ ูุงุฆูุฉ ุงููุณุชุซูุฑูู</h2>
                <!--onclick="openModal('userModal')": ุนูุฏ ุงูุถุบุท ุนูู ูุฐุง ุงูุฒุฑุ ุณูููู ููุฏ ุงูุจุฑูุฌุฉ ุจูุชุญ "ูุงูุฐุฉ ููุจุซูุฉ" (Modal) ุชุญุชูู ุนูู ูููุฐุฌ (Form) ูุชุนุจุฆุฉ ุจูุงูุงุช ุงูุดุฎุต ุงูุฌุฏูุฏ.-->
                <button class="btn btn-primary" onclick="openModal('userModal')"><i class="fas fa-plus"></i> ุฅุถุงูุฉ ูุณุชุซูุฑ</button>
            </div>
            <!--ุชูุฑุชุจ ููู ุจูุงูุงุช ุงููุณุชุซูุฑูู ุจุดูู ุงุญุชุฑุงูู-->
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>ID#</th>
                        <th>ุงูุงุณู ุงููุงูู</th>
                        <th>ุฑูู ุงูุฌูุงู</th>
                        <th>ุงูุฑุตูุฏ</th>
                        <th>ุงูููุชููุงุช</th>
                        <th>ุงููุจูุบ ุงูููู ุงููุฏููุน</th>
                        <th>ุงูุฃุณูู</th>
                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                    </tr>
                </thead>
                <!--ุฌูุจ ุจูุงูุงุช ุงูุฃุดุฎุงุต ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุถุงูุชูุง ููุง "ุฏููุงููููุงู" ุนูู ุดูู ุตููู (<tr>).-->
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="market" class="tab">
        <div class="section">
            <div class="section-header"><h2>๐ ุฅุฏุงุฑุฉ ุงูุฃุณูู ูุงูููุชุฌุงุช</h2></div>
                <!--ูุญุชูู ุนูู ุตูุงุฏูู ุงููุต ุงูุชู ุชุนุจุฆูุง ูุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ:-->
            <div class="input-group">
                <input type="text" id="pName" placeholder="ุงุณู ุงูุณูู/ุงููุดุฑูุน">
                <input type="number" id="pPrice" placeholder="ุณุนุฑ ุงูุณูู ุงููุงุญุฏ">
                <input type="number" id="pReturn" placeholder="ุงูุนุงุฆุฏ ุงููุชููุน %">
                <!--ุนูุฏ ุถุบุทูุ ูุชู ุงุณุชุฏุนุงุก ูุธููุฉ addProduct() ุงูุชู ุชุฃุฎุฐ ุงูุจูุงูุงุช ูู ุงูุตูุงุฏูู ูุชุถุนูุง ูู ุงูุฌุฏูู ุจุงูุฃุณูู.-->
                <button class="btn btn-success" onclick="addProduct()"><i class="fas fa-plus"></i> ุฅุถุงูุฉ ููุณูู</button>
            </div>
            <!--ุฌุฏูู ุนุฑุถ ุงูุณูู (Market Table)-->
            <table id="marketTable">
                <thead><tr><th>ุงุณู ุงูุณูู</th><th>ุงูุณุนุฑ</th><th>ุงูุนุงุฆุฏ ุงููุชููุน</th><th>ุญุงูุฉ ุงูุณูู</th><th>ุชุญูู</th></tr></thead>
                <!--ูุชู ุชุนุจุฆุชู ุขููุงู ุจูุงุณุทุฉ ุงูุจุฑูุฌุฉ-->
                <tbody></tbody>
            </table>
        </div>
    </div>
<!--ุบุฑูุฉ ุงูุนูููุงุช" ุงููุงููุฉ (Withdrawals)ุ ููู ูุฎุตุตุฉ ูุฅุฏุงุฑุฉ ุทูุจุงุช ุงููุณุชุซูุฑูู ุงูุฐูู ูุฑูุฏูู ุณุญุจ ุฃููุงููู ูู ุงูุชุทุจูู ุฅูู ุงููุงูุน.-->
    <div id="withdrawals" class="tab">
        <div class="section">
            <div class="section-header"><h2>๐ธ ุทูุจุงุช ุงูุณุญุจ ุงููุนููุฉ</h2></div>
            <table id="withdrawalsTable">
                <thead><tr><th>ุงููุณุชุซูุฑ</th><th>ุงููุจูุบ ุงููุทููุจ</th><th>ุชุงุฑูุฎ ุงูุทูุจ</th><th>ุงููุฑุงุฑ</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!--"ุนูู" ุงูุชุทุจูู ุงููุงููุ ููู ุงููุณุคูู ุนู ุชูุฒูุน ุงูุฃุฑุจุงุญ ุนูู ุงููุณุงูููู.-->
    <div id="profits" class="tab">
        <!--ุงูุฌุฏูู ุงูุฏุฎูู ุงูุฐู ูุญุชูู ุงููุนูููุงุช ุจุฏุงุฎูู-->
        <div class="section" style="max-width: 600px; margin: auto; text-align: center;">
            <!--ุณุชุงูู ููุท-->
            <i class="fas fa-coins" style="font-size: 4rem; color: var(--warning); margin-bottom: 20px;"></i>
            <h2 style="margin-bottom: 10px;">ูุธุงู ุชูุฒูุน ุงูุฃุฑุจุงุญ ุงูุฐูู</h2>
            <p style="color: var(--secondary); margin-bottom: 20px;">ุณูุชู ุชูุฒูุน ุงูุฃุฑุจุงุญ ูุฅุถุงูุชูุง ุชููุงุฆูุงู ููุญุงูุธ ุงููุณุชุฎุฏููู.</p>
            
            <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: right;">
                <div class="form-group mb-4">
                    <label style="font-weight:bold;">ุงุฎุชุฑ ุขููุฉ ุงูุชูุฒูุน:</label>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button class="btn btn-sm btn-primary" id="btnTotalMode" onclick="toggleProfitMode('total')">ูุจูุบ ููู ููุฒุน ุจุงูุชุณุงูู</button>
                        <button class="btn btn-sm" id="btnShareMode" style="background:#e2e8f0; color:#333" onclick="toggleProfitMode('share')">ุฑุจุญ ูุญุฏุฏ ููู ุณูู</button>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <label id="profitLabel" style="display:block; margin-bottom:5px;">ุงููุจูุบ ุงูุฅุฌูุงูู (ู.ุณ):</label>
                    <input type="number" id="profitInput" placeholder="ุฃุฏุฎู ุงููุจูุบ ููุง..." oninput="calculatePreview()">
                </div>
                
                <div style="margin-top: 15px; font-size: 0.9rem; color: var(--primary);">
                    <i class="fas fa-calculator"></i> ุฅุฌูุงูู ุงูุฃุณูู ุงููุดุทุฉ: <strong id="activeSharesDisplay">0</strong>
                    <br>
                    <span id="previewText">ุงููุจูุบ ููู ุณูู: 0 ู.ุณ</span>
                </div>
            </div>

            <button class="btn btn-success" style="width: 100%; padding: 15px;" onclick="executeDistribution()">
                <i class="fas fa-check-circle"></i> ุงุนุชูุงุฏ ูุชูุฒูุน ุงูุฃุฑุจุงุญ
            </button>
        </div>
    </div>
    <!--ุตูุญุฉ ุงูุณุฌูุงุช-->
    <div id="logs" class="tab">
        <div class="section">
            <div class="section-header"><h2>๐ ุณุฌู ุงููุธุงู ุงููุงูู</h2></div>
            <div id="timelineBox" class="timeline"></div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="userModal">
    <div class="modal-box">
        <div class="modal-header">
            <span>ุฅุถุงูุฉ ูุณุชุซูุฑ ุฌุฏูุฏ</span>
            <button class="modal-close" onclick="closeModal('userModal')">&times;</button>
        </div>
        <!--id="newUserName": ุญูู ูุตู ููุชุงุจุฉ ุงุณู ุงููุณุชุซูุฑ-->
        <input type="text" id="newUserName" placeholder="ุงูุงุณู ุงูุซูุงุซู">
        
        <input type="tel" 
               id="newUserPhone" 
               placeholder="ุฑูู ุงูุฌูุงู (10 ุฃุฑูุงู)" 
               maxlength="10" 
               oninput="this.value = this.value.replace(/[^0-9]/g, '')"
               style="width: 100%; padding: 10px; margin-top: 10px; border: 1px solid #ddd; border-radius: 5px;">
        
        <!--id="newUserBalance": ุญูู ุฑููู ูุฅุฏุฎุงู ุงููุจูุบ ุงูุฐู ุณูุจุฏุฃ ุจู ุงููุณุชุซูุฑ (ุฑุตูุฏู ุงูุฃููู).-->
        <input type="number" id="newUserBalance" placeholder="ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู (ุงุฎุชูุงุฑู)">
        <!--ุนูุฏ ุงูุถุบุท ุนูููุ ูุชู ุงุณุชุฏุนุงุก ูุธููุฉ ุจุฑูุฌุฉ ุชููู ุจุฃุฎุฐ ุงูุฃุณูุงุก ูุงูุฃุฑูุงู ูู ุงูุญูููุ ุฅุถุงูุชูุง ููุฌุฏููุ ุซู ุฅุบูุงู ุงููุงูุฐุฉ-->
        <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="confirmAddUser()">ุญูุธ ุงูุจูุงูุงุช</button>
    </div>
</div>
<!--ููุดุฆ ูุงูุฐุฉ ููุจุซูุฉ (Modal) ูุฎุตุตุฉ ูุบุฑุถ ูุงุญุฏ ูุญุณุงุณุ ููู ุชุนุฏูู ุฑุตูุฏ ูุณุชุซูุฑ ูุนูู (ุฅุถุงูุฉ ุฃููุงู ุฃู ุณุญุจูุง ูุฏูููุง).-->
<div class="modal-overlay" id="balanceModal">
    <div class="modal-box">
        <div class="modal-header">
            <span>ุชุนุฏูู ุงููุญูุธุฉ ุงููุงููุฉ</span>
            <button class="modal-close" onclick="closeModal('balanceModal')">&times;</button>
        </div>
        <input type="hidden" id="editUserId">
        <p style="margin-bottom:10px; font-size:0.9rem;">ุฃุฏุฎู ุงููููุฉ ุงููุฑุงุฏ ุฅุถุงูุชูุง (ุฃู ุณุงูุจ ููุฎุตู)</p>
        <input type="number" id="balanceAmount" placeholder="ูุซุงู: 5000 ุฃู -2000">
        <button class="btn btn-warning" style="width:100%; margin-top:15px;" onclick="confirmEditBalance()">ุชุญุฏูุซ ุงูุฑุตูุฏ</button>
    </div>
</div>

<div class="modal-overlay" id="assetModal">
    <div class="modal-box">
        <div class="modal-header">
            <span>ุดุฑุงุก ุฃุณูู ูููุณุชุซูุฑ</span>
            <button class="modal-close" onclick="closeModal('assetModal')">&times;</button>
        </div>
        <input type="hidden" id="assetUserId">
        <label>ุงุฎุชุฑ ุงูุณูู:</label>
        <select id="assetSelect"></select>
        <label style="margin-top:10px; display:block;">ุงููููุฉ:</label>
        <input type="number" id="assetQty" value="1" min="1">
        <button class="btn btn-purple" style="width:100%; margin-top:15px;" onclick="confirmAddAsset()">ุดุฑุงุก ูุฅุถุงูุฉ</button>
    </div>
</div>


<script type="text/javascript">

    
    
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();

    (function(){

        var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];

        s1.async=true;

        s1.src='https://embed.tawk.to/YOUR_ID_HERE/default'; // ุงุณุชุจุฏู ูุฐุง ุจุฑุงุจุท ุญุณุงุจู ุงูุญูููู

        s1.charset='UTF-8';

        s1.setAttribute('crossorigin','*');

        s0.parentNode.insertBefore(s1,s0);

    })();
</script>
    
    
<script type="module" src="control.js">try {
    
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

const auth = getAuth();

// ูุฐุง ุงูููุฏ ููุญุต ุญุงูุฉ ุงููุณุชุฎุฏู ููุฑ ูุชุญ ุงูุตูุญุฉ
onAuthStateChanged(auth, (user) => {
    if (!user) {
        // ุฅุฐุง ูู ููู ูุณุฌู ุฏุฎููุ ุงุฑุฌุนู ูุตูุญุฉ ุงูุฏุฎูู ููุฑุงู
        window.location.href = "index.html"; 
    } else {
        // ุฅุฐุง ุญุงูู ูุณุชุฎุฏู ุนุงุฏู ุงูุฏุฎููุ ุงุทุฑุฏู (ุงุฎุชูุงุฑู)
        if (user.email !== "admin33@tajer44.com") {
             alert("ุบูุฑ ูุณููุญ ูู ุจุงูุฏุฎูู");
             signOut(auth).then(() => window.location.href = "index.html");
        }
    }
});
        
    await signInWithEmailAndPassword(auth, email, password);
    // ูุฐุง ูู ุงูุณุทุฑ ุงูุณุญุฑู ุงูุฐู ููููู ูุตูุญุฉ ุงูุฅุฏุงุฑุฉ ููุฑ ุงููุฌุงุญ
    window.location.href = "admin.html"; 
} catch (error) {
    errorMsg.style.display = "block";
    loginBtn.disabled = false;
    loginBtn.innerText = "ุชุณุฌูู ุงูุฏุฎูู";
}</script>



</body>
</html>