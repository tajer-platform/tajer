<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุงูููุญุฉ ุงูุฑุฆูุณูุฉ | ุฅุฏุงุฑูุฉ ุชูุงุฌูุฑ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="control.css">
    <style>
        /* ุชุญุณููุงุช ุงูุชุตููู */
        .toast-msg {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #1f2937; color: #fff; padding: 12px 25px; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 10000; opacity: 0; transition: 0.3s;
            display: flex; align-items: center; gap: 10px; font-weight: bold; pointer-events: none;
        }
        .confirm-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center;
            z-index: 11000; opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .confirm-modal.show { opacity: 1; pointer-events: auto; }
        .confirm-box {
            background: #fff; width: 90%; max-width: 400px; padding: 25px;
            border-radius: 20px; text-align: center; transform: scale(0.8); transition: 0.3s;
        }
        .confirm-modal.show .confirm-box { transform: scale(1); }
        .confirm-actions { display: flex; gap: 10px; margin-top: 20px; }
        .confirm-actions button { flex: 1; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; }
        
        /* ุชูุณูู ุทูุจุงุช ุงูุณุญุจ */
        .withdraw-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 15px; }
        .withdraw-card { background: #fff; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .withdraw-card h4 { margin-bottom: 5px; color: #1e293b; }
        .withdraw-card .price { font-size: 1.2rem; font-weight: 800; color: #2563eb; margin: 10px 0; }
        .withdraw-card .actions { display: flex; gap: 8px; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-box">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #f59e0b; margin-bottom: 15px;"></i>
            <h3 id="confirmTitle">ุชุฃููุฏ ุงูุนูููุฉ</h3>
            <p id="confirmMessage" style="color: #64748b; margin-top: 10px;"></p>
            <div class="confirm-actions">
                <button id="confirmNoBtn" style="background: #f1f5f9; color: #334155;">ุฅูุบุงุก</button>
                <button id="confirmYesBtn" style="background: #2563eb; color: #fff;">ุชุฃููุฏ ุงูุชูููุฐ</button>
            </div>
        </div>
    </div>

    
    <button class="menu-toggle" onclick="toggleMenu()">
        โฐ ุงููุงุฆูุฉ
    </button>

    <div class="sidebar" id="mySidebar">
        </div>

    <div class="main">
        </div>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header"><i class="fas fa-layer-group"></i> ุชูุงุฌุฑ <span>Admin</span></div>
        <div class="nav">
            <button class="active" onclick="openTab('dashboard',this)"><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</button>
            <button onclick="openTab('users',this)"><i class="fas fa-users"></i> ุงููุณุชุซูุฑูู</button>
            <button onclick="window.location.href='messages.html'"><i class="fas fa-comments"></i> ูุฑูุฒ ุงูุฑุณุงุฆู</button>
            <button onclick="openTab('market',this)"><i class="fas fa-store"></i> ุฅุฏุงุฑุฉ ุงูุณูู</button>
            <button onclick="openTab('withdrawalsTab',this)"><i class="fas fa-money-bill-wave"></i> ุทูุจุงุช ุงูุณุญุจ</button>
            <button onclick="openTab('profits',this)"><i class="fas fa-hand-holding-usd"></i> ุชูุฒูุน ุงูุฃุฑุจุงุญ</button>
            <button onclick="openTab('logs',this)"><i class="fas fa-history"></i> ุงูุณุฌู</button>
            <button onclick="logout()" style="margin-top: 20px; color: #ef4444; background: rgba(239,68,68,0.1); border: 1px solid #ef4444;">
                <i class="fas fa-sign-out-alt"></i> ุชุณุฌูู ุงูุฎุฑูุฌ
            </button>
        </div>
    </div>

    <div class="main">
        <div id="toastContainer"></div>

        <div id="dashboard" class="tab active">
            <div class="grid">
                <div class="stat-card border-l">
                    <i class="fas fa-users icon-bg"></i>
                    <h3>ุฅุฌูุงูู ุงููุณุชุซูุฑูู</h3>
                    <span class="val" id="d-users">0</span>
                </div>
                <div class="stat-card border-s">
                    <i class="fas fa-wallet icon-bg"></i>
                    <h3>ุฑุฃุณ ุงููุงู (ู.ุณ)</h3>
                    <span class="val" id="d-capital">0</span>
                </div>
                <div class="stat-card border-i">
                    <i class="fas fa-boxes icon-bg"></i>
                    <h3>ุฅุฌูุงูู ุงูุฃุณูู ุงููุจุงุนุฉ</h3>
                    <span class="val" id="d-total-shares">0</span>
                </div>
                <div class="stat-card special" onclick="openModal('sharePriceModal')">
                    <i class="fas fa-chart-pie icon-bg"></i>
                    <h3>ุณุนุฑ ุงูุณูู ุงูุญุงูู</h3> 
                    <span class="val" id="d-share-value">0</span>
                    <span style="font-size: 0.8rem; opacity: 0.8;">ู.ุณ / ุงุถุบุท ููุชุนุฏูู</span>
                </div>
            </div>
            <div class="section" style="margin-top:20px;">
                <div class="section-header">
                    <h2>๐ฅ ุขุฎุฑ ุงูุนูููุงุช</h2>
                </div>
                <div id="miniLogBox"></div>
            </div>
        </div>

        <div id="users" class="tab">
            <div class="section">
                <div class="section-header">
                    <h2>๐ฅ ูุงุฆูุฉ ุงููุณุชุซูุฑูู</h2>
                    <button class="btn btn-primary" onclick="openModal('userModal')"><i class="fas fa-plus"></i> ุฅุถุงูุฉ ูุณุชุซูุฑ</button>
                </div>
                <div style="overflow-x: auto;">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ุงูุงุณู ุงููุงูู</th>
                                <th>ุงููุญูุธุฉ</th>
                                <th>ุงูููุชููุงุช</th>
                                <th>ุฅุฌูุงูู ุงูุงุณุชุซูุงุฑ</th>
                                <th>ุงูุฃุณูู</th>
                                <th>ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="market" class="tab">
            <div class="section">
                <div class="section-header"><h2>๐ ุฅุฏุงุฑุฉ ุงูุณูู ูุงููุฎุฒูู</h2></div>
                <div class="input-group" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 10px;">
                    <input type="text" id="pName" placeholder="ุงุณู ุงูููุชุฌ">
                    <input type="text" id="pPrice" placeholder="ุงูุณุนุฑ">
                    <input type="number" id="pReturn" placeholder="ุงูุนุงุฆุฏ %">
                    <input type="text" id="pQty" placeholder="ุงููููุฉ">
                    <button class="btn btn-success" onclick="addProduct()"><i class="fas fa-plus"></i> ุฅุถุงูุฉ</button>
                </div>
                <table id="marketTable" style="margin-top: 15px;">
                    <thead>
                        <tr>
                            <th>ุงูููุชุฌ</th><th>ุงูุณุนุฑ</th><th>ุงูุนุงุฆุฏ</th><th>ุงููุฎุฒูู</th><th>ุงูุญุงูุฉ</th><th>ุญุฐู</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="withdrawalsTab" class="tab">
            <div class="section">
                <div class="section-header">
                    <h2>๐ธ ุทูุจุงุช ุงูุณุญุจ ุงููุนููุฉ</h2>
                </div>
                <div id="withdrawalsContainer" class="withdraw-grid">
                    </div>
            </div>
        </div>

        <div id="profits" class="tab">
            <div class="section" style="max-width: 600px; margin: auto; text-align: center;">
                <i class="fas fa-coins" style="font-size: 4rem; color: #f59e0b; margin-bottom: 20px;"></i>
                <h2>ูุธุงู ุชูุฒูุน ุงูุฃุฑุจุงุญ</h2>
                <div style="background: #f8fafc; padding: 25px; border-radius: 12px; margin: 20px 0; border: 1px solid #e2e8f0; text-align: right;">
                    <label style="font-weight:bold; display:block; margin-bottom:10px;">ุงููุจูุบ ุงูุฅุฌูุงูู ููุชูุฒูุน:</label>
                    <input type="text" id="profitInput" placeholder="ุฃุฏุฎู ุงููุจูุบ..." style="width:100%; padding:15px; font-size:1.2rem; border-radius:10px; border:1px solid #cbd5e1;">
                    <div id="profitPerShareHint" style="margin-top:10px; padding:10px; background:#dcfce7; color:#166534; border-radius:8px; display:none; font-weight:bold;"></div>
                    <p style="margin-top: 15px; color: #64748b;">ุฅุฌูุงูู ุงูุฃุณูู ุงูุญุงููุฉ: <span id="d-total-shares-preview" style="font-weight: bold; color: #1e293b;">0</span></p>
                </div>
                <button class="btn btn-success" id="distributeBtn" style="width:100%; padding:15px;" onclick="executeDistribution()">ุงุนุชูุงุฏ ูุชูุฒูุน ุงูุฃุฑุจุงุญ</button>
            </div>
        </div>

        <div id="logs" class="tab">
            <div class="section">
                <div class="section-header"><h2>๐ ุณุฌู ุงููุธุงู ุงูุฒููู</h2></div>
                <div id="logsTimeline"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="sharePriceModal">
        <div class="modal-box">
            <div class="modal-header"><span>ุชุญุฏูุซ ูููุฉ ุงูุณูู</span><button class="modal-close" onclick="closeModal('sharePriceModal')">&times;</button></div>
            <input type="text" id="manualSharePriceInput" placeholder="ุงูุณุนุฑ ุงูุฌุฏูุฏ">
            <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="saveSharePrice()">ุญูุธ ุงููููุฉ</button>
        </div>
    </div>

    <div class="modal-overlay" id="userModal">
        <div class="modal-box">
            <div class="modal-header"><span>ุฅุถุงูุฉ ูุณุชุซูุฑ</span><button class="modal-close" onclick="closeModal('userModal')">&times;</button></div>
            <input type="text" id="newUserName" placeholder="ุงูุงุณู ุงููุงูู">
            <input type="text" id="newUserPhone" placeholder="ุฑูู ุงูุฌูุงู">
            <input type="text" id="newUserBalance" placeholder="ุงูุฑุตูุฏ ุงูุงุจุชุฏุงุฆู">
            <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="confirmAddUser()">ุฅุถุงูุฉ ุงููุณุชุซูุฑ</button>
        </div>
    </div>

    <div class="modal-overlay" id="balanceModal">
        <div class="modal-box">
            <div class="modal-header"><span>ุชุนุฏูู ุงููุญูุธุฉ</span><button class="modal-close" onclick="closeModal('balanceModal')">&times;</button></div>
            <input type="hidden" id="editUserId">
            <input type="text" id="balanceAmount" placeholder="ุงููุจูุบ (ุงุณุชุฎุฏู - ููุฎุตู)">
            <button class="btn btn-warning" style="width:100%; margin-top:15px;" onclick="confirmEditBalance()">ุชุญุฏูุซ ุงูุฑุตูุฏ</button>
        </div>
    </div>

<div class="modal-overlay" id="assetModal">
    <div class="modal-box" style="max-width: 500px;">
        <div class="modal-header">
            <span><i class="fas fa-shopping-cart"></i> ุชูููุฐ ุนูููุฉ ุดุฑุงุก ูููุณุชุซูุฑ</span>
            <button class="modal-close" onclick="closeModal('assetModal')">&times;</button>
        </div>
        
        <div class="modal-body" style="padding: 20px;">
            <input type="hidden" id="assetUserId">
            
            <label>ุงุฎุชุฑ ุงูููุชุฌ ูู ุงูุณูู:</label>
            <select id="assetSelect" onchange="updateProductDetails()" style="width:100%; padding:12px; margin-bottom:15px; border-radius:10px; border:2px solid #e2e8f0; font-weight: bold;"></select>

            <div id="productDetailCard" style="background: #f8fafc; border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #cbd5e1; display: none;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #64748b;">ุงูุณุนุฑ ูููุญุฏุฉ:</span>
                    <span id="detailPrice" style="font-weight: bold; color: #1e293b;">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #64748b;">ุงูุนุงุฆุฏ ุงููุชููุน:</span>
                    <span id="detailReturn" style="font-weight: bold; color: #10b981;">0%</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: #64748b;">ุงููุชููุฑ ูู ุงููุฎุฒู:</span>
                    <span id="detailStock" style="font-weight: bold; color: #f59e0b;">0</span>
                </div>
            </div>

            <label>ุงููููุฉ ุงููุทููุจุฉ:</label>
            <input type="number" id="assetQty" value="1" min="1" oninput="calculateTotal()" style="width:100%; padding:12px; font-size:1.1rem; border-radius:10px; border:2px solid #e2e8f0;">

            <div style="margin-top: 20px; padding-top: 15px; border-top: 2px dashed #e2e8f0;">
                <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 800;">
                    <span>ุฅุฌูุงูู ุงูุชูููุฉ:</span>
                    <span id="totalPurchasePrice" style="color: #2563eb;">0 ู.ุณ</span>
                </div>
                <p id="balanceWarning" style="color: #ef4444; font-size: 0.85rem; margin-top: 5px; display: none;">โ๏ธ ุฑุตูุฏ ุงููุณุชุซูุฑ ุบูุฑ ูุงูู ููุฐู ุงูุนูููุฉ</p>
            </div>

            <button class="btn btn-purple" id="confirmPurchaseBtn" style="width:100%; margin-top:20px; padding: 15px; font-size: 1rem;" onclick="confirmAddAsset()">
                <i class="fas fa-check-circle"></i> ุชุฃููุฏ ุนูููุฉ ุงูุดุฑุงุก
            </button>
        </div>
    </div>
</div>
    <script>
    function toggleMenu() {
        // ูุญุฏุฏ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
        const sidebar = document.querySelector('.sidebar');
        
        // ูููู ุจุฅุถุงูุฉ ุฃู ุฅุฒุงูุฉ ููุงุณ ุงุณูู 'active'
        sidebar.classList.toggle('active');
    }

    // ููุฏ ุฅุถุงูู: ูุฅุบูุงู ุงููุงุฆูุฉ ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌูุง (ุงุฎุชูุงุฑู ููู ุงุญุชุฑุงูู)
    document.addEventListener('click', function(event) {
        const sidebar = document.querySelector('.sidebar');
        const menuBtn = document.querySelector('.menu-toggle');
        
        // ุฅุฐุง ูุงูุช ุงูุถุบุทุฉ ุฎุงุฑุฌ ุงููุงุฆูุฉ ูุฎุงุฑุฌ ุงูุฒุฑุ ูุงููุงุฆูุฉ ููุชูุญุฉ -> ุฃุบูููุง
        if (!sidebar.contains(event.target) && !menuBtn.contains(event.target) && sidebar.classList.contains('active')) {
            sidebar.classList.remove('active');
        }
    });
    </script>

    <script type="module" src="control.js"></script>
</body>
</html> 
